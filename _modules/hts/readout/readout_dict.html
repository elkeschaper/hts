<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hts.readout.readout_dict &mdash; HTS 0.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="HTS 0.0.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hts.readout.readout_dict</h1><div class="highlight"><pre>
<span class="c"># (C) 2015 Elke Schaper</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :synopsis: The ReadoutDict Class.</span>

<span class="sd">    .. moduleauthor:: Elke Schaper &lt;elke.schaper@isb-sib.ch&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">hts.readout</span> <span class="kn">import</span> <span class="n">plate_io</span><span class="p">,</span> <span class="n">readout</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="ReadoutDict"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict">[docs]</a><span class="k">class</span> <span class="nc">ReadoutDict</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot; ``ReadoutDict`` describes all information connected to the readout_dict</span>
<span class="sd">    of a high throughput screen. This could be either several readouts of a</span>
<span class="sd">    plate, or the same readout across several plates.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Name of the readout_dict (e.g. plate)</span>
<span class="sd">        #width (int): Width of the plate</span>
<span class="sd">        #height (int): Height of the plate</span>
<span class="sd">        read_outs (dict of Readout): The raw readouts from i.e. the envision reader.</span>
<span class="sd">        net_read_outs (dict of Readout): The net readouts derived from the read_outs</span>


<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ReadoutDict.__str__"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create string for ReadoutDict instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&lt;not named&gt;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">readout_dict</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&lt;ReadoutDict instance&gt;</span><span class="se">\n</span><span class="s">name: {}</span><span class="se">\n</span><span class="s">read_outs: {}&quot;</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="s">Number of read_outs: {}</span><span class="se">\n</span><span class="s">width: {}</span><span class="se">\n</span><span class="s">height: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">readout_dict</span> <span class="o">=</span> <span class="s">&quot;&lt;ReadoutDict instance&gt;&quot;</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Could not create string of ReadoutDict instance.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">readout_dict</span>

</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">read_outs</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">read_outs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">j</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="n">readout</span><span class="o">.</span><span class="n">Readout</span> <span class="k">else</span> <span class="n">readout</span><span class="o">.</span><span class="n">Readout</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">read_outs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c"># Make sure all readouts are equal in height and width.</span>
        <span class="n">plate_heights</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">plate_widths</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">plate_heights</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">plate_widths</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;ReadoutDict widths and lengths in the parsed output &quot;</span>
                <span class="s">&quot;files are not all equal: plate_heights: {}, plate_widths: {} &quot;</span>
                    <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plate_heights</span><span class="p">,</span> <span class="n">plate_widths</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">plate_heights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">plate_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<div class="viewcode-block" id="ReadoutDict.create"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create ``ReadoutDict`` instance.</span>

<span class="sd">        Create ``ReadoutDict`` instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to input file or directory</span>
<span class="sd">            format (str):  Format of the input file, at current not specified</span>

<span class="sd">        .. todo:: Write checks for ``format`` and ``path``.</span>
<span class="sd">        .. todo:: Implement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_trunk</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">file</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;filename: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">file</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;csv&#39;</span><span class="p">:</span>
            <span class="n">readout_dict</span> <span class="o">=</span> <span class="n">plate_io</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ReadoutDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">read_outs</span><span class="o">=</span><span class="n">readout_dict</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;excel&#39;</span><span class="p">:</span>
            <span class="n">readout_dict</span> <span class="o">=</span> <span class="n">plate_io</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ReadoutDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">read_outs</span><span class="o">=</span><span class="n">readout_dict</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;envision_csv&#39;</span><span class="p">:</span>
            <span class="n">readout_dict_info</span><span class="p">,</span> <span class="n">channel_wise_reads</span><span class="p">,</span> <span class="n">channel_wise_info</span> <span class="o">=</span> <span class="n">plate_io</span><span class="o">.</span><span class="n">read_envision_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ReadoutDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">read_outs</span><span class="o">=</span><span class="n">channel_wise_reads</span><span class="p">,</span> <span class="n">readout_dict_info</span><span class="o">=</span><span class="n">readout_dict_info</span><span class="p">,</span> <span class="n">channel_wise_info</span><span class="o">=</span><span class="n">channel_wise_info</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;insulin_csv&#39;</span><span class="p">:</span>
            <span class="n">readout_dict_info</span><span class="p">,</span> <span class="n">channel_wise_reads</span><span class="p">,</span> <span class="n">channel_wise_info</span> <span class="o">=</span> <span class="n">plate_io</span><span class="o">.</span><span class="n">read_insulin_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ReadoutDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">read_outs</span><span class="o">=</span><span class="n">channel_wise_reads</span><span class="p">,</span> <span class="n">readout_dict_info</span><span class="o">=</span><span class="n">readout_dict_info</span><span class="p">,</span> <span class="n">channel_wise_info</span><span class="o">=</span><span class="n">channel_wise_info</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;pickle&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Format: {} is not implemented in &quot;</span>
                            <span class="s">&quot;ReadoutDict.create()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="ReadoutDict.get_readout"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict.get_readout">[docs]</a>    <span class="k">def</span> <span class="nf">get_readout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Retrieve readout `tag`</span>

<span class="sd">        Retrieve readout `tag`</span>

<span class="sd">        Args:</span>
<span class="sd">            tag (str): Key of readout</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;tag: {} is not in self.readouts: {}&#39;</span>
                                <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="ReadoutDict.set_plate_layout"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict.set_plate_layout">[docs]</a>    <span class="k">def</span> <span class="nf">set_plate_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plate_layout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set `self.plate_layout`</span>

<span class="sd">        Set `self.plate_layout`</span>

<span class="sd">        Args:</span>
<span class="sd">            plate_layout (PlateLayout): A ``PlateLayout`` instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plate_layout</span> <span class="o">=</span> <span class="n">plate_layout</span>
        <span class="c"># Push PlateLayout to readouts</span>
        <span class="k">for</span> <span class="n">read_out</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">read_out</span><span class="o">.</span><span class="n">plate_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plate_layout</span>


</div>
<div class="viewcode-block" id="ReadoutDict.write"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">return_string</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Serialize and write ``ReadoutDict`` instances.</span>

<span class="sd">        Serialize ``ReadoutDict`` instance using the stated ``format``.</span>

<span class="sd">        Args:</span>
<span class="sd">            format (str):  The output format: Currently only &quot;pickle&quot;.</span>
<span class="sd">            path (str): Path to output file</span>

<span class="sd">        .. todo:: Write checks for ``format`` and ``path``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;pickle&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Format is unknown: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span>

    <span class="c">#### Preprocessing functions</span>
</div>
<div class="viewcode-block" id="ReadoutDict.preprocess"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict.preprocess">[docs]</a>    <span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methodname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methodname</span><span class="p">)</span>
            <span class="n">method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ReadoutDict.calculate_net_fret"><a class="viewcode-back" href="../../../hts.readout.html#hts.readout.readout_dict.ReadoutDict.calculate_net_fret">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_net_fret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">donor_channel</span><span class="p">,</span> <span class="n">acceptor_channel</span><span class="p">,</span>
                            <span class="n">fluorophore_donor</span> <span class="o">=</span> <span class="s">&quot;fluorophore_donor&quot;</span><span class="p">,</span>
                            <span class="n">fluorophore_acceptor</span> <span class="o">=</span> <span class="s">&quot;fluorophore_acceptor&quot;</span><span class="p">,</span>
                            <span class="nb">buffer</span> <span class="o">=</span> <span class="s">&quot;buffer&quot;</span><span class="p">,</span> <span class="n">net_fret_key</span> <span class="o">=</span> <span class="s">&quot;net_fret&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the net FRET signal for a donor acceptor FRET setup.</span>

<span class="sd">        Calculate the net FRET signal for a donor acceptor FRET setup.</span>
<span class="sd">        Typical donor -&gt; aceptor pairs include</span>

<span class="sd">        * 414nm CFP -&gt; 475nm -&gt; YFP 525nm</span>
<span class="sd">        * EU -&gt; 615nm -&gt; APC 665nm</span>

<span class="sd">        The following wells are needed, for both channels</span>

<span class="sd">        * `donor` Donor_fluorophor blank</span>
<span class="sd">        * `acceptor` Acceptor_fluorophor blank</span>
<span class="sd">        * `buffer` Buffer blank</span>

<span class="sd">        The proportionality factor for donor compensation is then calculation as</span>
<span class="sd">        .. math::</span>

<span class="sd">        p = \frac{\hat{donor_{acceptor_channel}} - \hat{buffer_{acceptor_channel}}}{\hat{donor_{donor_channel}} - \hat{buffer_{donor_channel}}}</span>

<span class="sd">        Further, the net FRET signal `f` for all wells `x` may be calculated as:</span>
<span class="sd">        .. math::</span>

<span class="sd">        netfret = x_{acceptor_channel} - \hat{acceptor_{acceptor_channel}} - p \cdot (x_{donor_channel} - \hat{buffer_{donor_channel}})</span>

<span class="sd">        Args:</span>
<span class="sd">            donor_channel (str):  The key for self.read_outs where the donor_channel ``Readout`` instance is stored.</span>
<span class="sd">            acceptor_channel (str):  The key for self.read_outs where the acceptor_channel ``Readout`` instance is stored.</span>
<span class="sd">            fluorophore_donor (str):  The name of the donor fluorophore in self.plate_layout.</span>
<span class="sd">            fluorophore_acceptor (str):  The name of the acceptor fluorophore in self.plate_layout.</span>
<span class="sd">            buffer (str):  The name of the buffer in self.plate_layout.</span>
<span class="sd">            net_fret_key (str):  The key for self.read_outs where the resulting net fret ``Readout`` instance will be stored.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">net_fret_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The net_fret_key {} is already in self.read_outs.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net_fret_key</span><span class="p">))</span>

        <span class="c">#import pdb; pdb.set_trace()</span>
        <span class="n">donor_readout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">[</span><span class="n">donor_channel</span><span class="p">]</span>
        <span class="n">acceptor_readout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">[</span><span class="n">acceptor_channel</span><span class="p">]</span>

        <span class="c"># Calculate p</span>
        <span class="n">mean_donor_donor_channel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">donor_readout</span><span class="o">.</span><span class="n">filter_wells</span><span class="p">(</span><span class="n">fluorophore_donor</span><span class="p">))</span>
        <span class="n">mean_acceptor_donor_channel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">donor_readout</span><span class="o">.</span><span class="n">filter_wells</span><span class="p">(</span><span class="n">fluorophore_acceptor</span><span class="p">))</span>
        <span class="n">mean_buffer_donor_channel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">donor_readout</span><span class="o">.</span><span class="n">filter_wells</span><span class="p">(</span><span class="nb">buffer</span><span class="p">))</span>
        <span class="n">mean_donor_acceptor_channel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acceptor_readout</span><span class="o">.</span><span class="n">filter_wells</span><span class="p">(</span><span class="n">fluorophore_donor</span><span class="p">))</span>
        <span class="n">mean_acceptor_acceptor_channel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acceptor_readout</span><span class="o">.</span><span class="n">filter_wells</span><span class="p">(</span><span class="n">fluorophore_acceptor</span><span class="p">))</span>
        <span class="n">mean_buffer_acceptor_channel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acceptor_readout</span><span class="o">.</span><span class="n">filter_wells</span><span class="p">(</span><span class="nb">buffer</span><span class="p">))</span>

        <span class="c">#import pdb; pdb.set_trace()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mean_donor_donor_channel</span><span class="p">,</span> <span class="n">mean_acceptor_donor_channel</span><span class="p">,</span> <span class="n">mean_buffer_donor_channel</span><span class="p">,</span> <span class="n">mean_donor_acceptor_channel</span><span class="p">,</span> <span class="n">mean_acceptor_acceptor_channel</span><span class="p">,</span> <span class="n">mean_buffer_acceptor_channel</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Calculation of {} resulted in {}. Check whether the plate layout is correctly assigned.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">))</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_donor_acceptor_channel</span> <span class="o">-</span> <span class="n">mean_buffer_acceptor_channel</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mean_donor_donor_channel</span> <span class="o">-</span> <span class="n">mean_buffer_donor_channel</span><span class="p">)</span>


        <span class="c"># Calculate the net FRET signal for the entire plate</span>
        <span class="n">netfret</span> <span class="o">=</span> <span class="n">acceptor_readout</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">mean_acceptor_acceptor_channel</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">donor_readout</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">mean_buffer_donor_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">[</span><span class="n">net_fret_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">readout</span><span class="o">.</span><span class="n">Readout</span><span class="p">(</span><span class="n">netfret</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_outs</span><span class="p">[</span><span class="n">net_fret_key</span><span class="p">]</span><span class="o">.</span><span class="n">plate_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plate_layout</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Elke Schaper.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>